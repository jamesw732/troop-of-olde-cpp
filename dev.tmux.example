#!/bin/bash
# automates build + server/client panes in tmux

# This script is built for WSL, but serves as a template for any tmux environment
# You'll basically just need to change the build location and executable names

SESSION="dev"

# 1. Create a new session if it doesn't exist
tmux has-session -t $SESSION 2>/dev/null
if [ $? != 0 ]; then
    tmux new-session -d -s $SESSION -n main
fi

# 2. Pane layout:
#    - pane 0: build/watch
#    - pane 1: server
#    - pane 2: client
tmux select-session -t $SESSION
tmux select-window -t $SESSION:0

# Split horizontally (server)
tmux split-window -h -t $SESSION:0

# Split vertically (client)
tmux split-window -v -t $SESSION:0.1

# 3. Send build commands to pane 0
tmux send-keys -t $SESSION:0.0 "cd $(pwd)" C-m
tmux send-keys -t $SESSION:0.0 "cmake --build build-win" C-m

# 4. Send server launch to pane 1
tmux send-keys -t $SESSION:0.1 "cd $(pwd)/build-win && ./server.exe" C-m

# 5. Send client launch to pane 2
tmux send-keys -t $SESSION:0.2 "cd $(pwd)/build-win && ./client.exe" C-m

# 6. Attach session
tmux attach -t $SESSION
